  template:
    # terraform:
    #   backend:
    #     bucket: 'tf-state-prod'
    #     prefix: 'terraform/state'
    data:
      local_file:
        {{ name }}_output_file:
          depends_on: [null_resource.{{ name }}_output]
          filename: ${path.module}/output.json
    resource:
      null_resource:
        {{ name }}:
          triggers:
            command: '${var.{{ name }}_command}'
            components: '${md5(jsonencode(var.{{ name }}_components))}'
          provisioner:
            - local-exec:
                when: create
                command: 'python ${local.component["path"]}/scripts/apply.py'
                environment:
                  root: '${local.project["path"]}'
                  command: '${var.{{ name }}_command}'
                  components: '${jsonencode(var.{{ name }}_components)}'
        {{ name }}_output:
          depends_on: [null_resource.{{ name }}]
          triggers:
            timestamp: '${timestamp()}'
          provisioner:
            - local-exec:
                command: 'python ${local.component["path"]}/scripts/output.py'
                environment:
                  root: '${local.project["path"]}'
                  components: '${jsonencode(var.{{ name }}_components)}'
    output:
      {{ name }}:
        value: ${data.local_file.{{ name }}_output_file.content}
    variable:
      {{ name }}_command:
        type: string
        default: run
      {{ name }}_components:
        type: map
    tfvars:
      {{ name }}_components:
        # '[COMPONENT_NAME]': 'TFVARS_PATH'
